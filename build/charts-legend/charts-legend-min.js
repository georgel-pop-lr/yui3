YUI.add("charts-legend",function(z,t){var y="top",p="right",_="bottom",w="left",o="horizontal",b="width",m="height",d="position",S="x",v="y",N="px",e={setter:function(t){var e=this.get("legend");return e&&e.destroy(!0),t instanceof z.ChartLegend?(e=t).set("chart",this):(t.chart=this,t.hasOwnProperty("render")||(t.render=this.get("contentBox"),t.includeInChartLayout=!0),e=new z.ChartLegend(t)),e}},B={_positionLegendItems:function(t,e,i,h,s,r,a,n,o){var g,l,d,c,f,u,y,p,_,w,b,m,S,v,C=0,L=0,x=this.get("width"),k=r.top-n,A=x-(r.left+r.right);for(B._setRowArrays(t,A,a),u=B.rowArray,_=B.totalWidthArray,y=u.length;L<y;++L){for(k+=n,f=(p=u[L]).length,w=B.getStartPoint(x,_[L],o,r),C=0;C<f;++C)l=(g=p[C]).node,d=g.width,c=g.height,g.x=w,g.y=0,b=isNaN(b)?w:Math.min(b,w),m=isNaN(m)?k:Math.min(m,k),S=isNaN(S)?w+d:Math.max(w+d,S),v=isNaN(v)?k+c:Math.max(k+c,v),l.setStyle("left",w+N),l.setStyle("top",k+N),w+=d+a;k+=g.height}this._contentRect={left:b,top:m,right:S,bottom:v},this.get("includeInChartLayout")&&this.set("height",k+r.bottom)},_setRowArrays:function(t,e,i){for(var h,s=t[0],r=[[s]],a=1,n=0,o=t.length,g=s.width,l=[[g]];a<o;++a)g+i+(h=(s=t[a]).width)<=e?(g+=i+h,r[n].push(s)):(g=i+h,r[n]&&(n+=1),r[n]=[s]),l[n]=g;B.rowArray=r,B.totalWidthArray=l},getStartPoint:function(t,e,i,h){var s;switch(i){case w:s=h.left;break;case"center":s=.5*(t-e);break;case p:s=t-e-h.right}return s}},I={_positionLegendItems:function(t,e,i,h,s,r,a,n,o){var g,l,d,c,f,u,y,p,_,w,b,m,S,v,C,L=0,x=0,k=this.get("height"),A=r.left-a,B=k-(r.top+r.bottom);for(I._setColumnArrays(t,B,n),u=I.columnArray,_=I.totalHeightArray,y=u.length;x<y;++x){for(A+=a,f=(p=u[x]).length,w=I.getStartPoint(k,_[x],o,r),L=b=0;L<f;++L)l=(g=p[L]).node,d=g.height,c=g.width,g.y=w,g.x=A,m=isNaN(m)?A:Math.min(m,A),S=isNaN(S)?w:Math.min(S,w),v=isNaN(v)?A+c:Math.max(A+c,v),C=isNaN(C)?w+d:Math.max(w+d,C),l.setStyle("left",A+N),l.setStyle("top",w+N),w+=d+n,b=Math.max(b,g.width);A+=b}this._contentRect={left:m,top:S,right:v,bottom:C},this.get("includeInChartLayout")&&this.set("width",A+r.right)},_setColumnArrays:function(t,e,i){for(var h,s=t[0],r=[[s]],a=1,n=0,o=t.length,g=s.height,l=[[g]];a<o;++a)g+i+(h=(s=t[a]).height)<=e?(g+=i+h,r[n].push(s)):(g=i+h,r[n]&&(n+=1),r[n]=[s]),l[n]=g;I.columnArray=r,I.totalHeightArray=l},getStartPoint:function(t,e,i,h){var s;switch(i){case y:s=h.top;break;case"middle":s=.5*(t-e);break;case _:s=t-e-h.bottom}return s}},i=z.Base.create("cartesianChartLegend",z.CartesianChart,[],{_redraw:function(){if(this._drawing)this._callLater=!0;else{this._drawing=!0,this._callLater=!1;var t,e,i,h,s,r,a,n,o,g,l,d,c,f,u=this.get("width"),y=this.get("height"),p=this._getLayoutBoxDimensions(),_=p.left,w=p.right,b=p.top,m=p.bottom,S=this.get("leftAxesCollection"),v=this.get("rightAxesCollection"),C=this.get("topAxesCollection"),L=this.get("bottomAxesCollection"),x=0,p="visible",k=this.get("graph"),A=this.get("allowContentOverflow"),B=this.get("legend"),I={};if(S)for(d=[],x=(t=S.length)-1;-1<x;--x)d.unshift(_),_+=S[x].get("width");if(v)for(l=[],x=0,x=(t=v.length)-1;-1<x;--x)w+=v[x].get("width"),l.unshift(u-w);if(C)for(c=[],x=(t=C.length)-1;-1<x;--x)c.unshift(b),b+=C[x].get("height");if(L)for(f=[],x=(t=L.length)-1;-1<x;--x)m+=L[x].get("height"),f.unshift(y-m);if(I.left=_,I.top=b,I.bottom=y-m,I.right=u-w,!A){if(A=this._getTopOverflow(S,v),i=this._getBottomOverflow(S,v),h=this._getLeftOverflow(L,C),s=this._getRightOverflow(L,C),0<(g=A-b)&&(I.top=A,c))for(x=0,t=c.length;x<t;++x)c[x]+=g;if(0<(g=i-m)&&(I.bottom=y-i,f))for(x=0,t=f.length;x<t;++x)f[x]-=g;if(0<(g=h-_)&&(I.left=h,d))for(x=0,t=d.length;x<t;++x)d[x]+=g;if(0<(g=s-w)&&(I.right=u-s,l))for(x=0,t=l.length;x<t;++x)l[x]-=g}if(r=I.right-I.left,a=I.bottom-I.top,n=I.left,o=I.top,B&&B.get("includeInChartLayout"))switch(B.get("position")){case"left":B.set("y",o),B.set("height",a);break;case"top":case"bottom":B.set("x",n),B.set("width",r);break;case"right":B.set("y",o),B.set("height",a)}if(C){for(t=C.length,x=0;x<t;x++)(e=C[x]).get("width")!==r&&e.set("width",r),e.get("boundingBox").setStyle("left",n+N),e.get("boundingBox").setStyle("top",c[x]+N);e._hasDataOverflow()&&(p="hidden")}if(L){for(t=L.length,x=0;x<t;x++)(e=L[x]).get("width")!==r&&e.set("width",r),e.get("boundingBox").setStyle("left",n+N),e.get("boundingBox").setStyle("top",f[x]+N);e._hasDataOverflow()&&(p="hidden")}if(S){for(t=S.length,x=0;x<t;++x)(e=S[x]).get("boundingBox").setStyle("top",o+N),e.get("boundingBox").setStyle("left",d[x]+N),e.get("height")!==a&&e.set("height",a);e._hasDataOverflow()&&(p="hidden")}if(v){for(t=v.length,x=0;x<t;++x)(e=v[x]).get("boundingBox").setStyle("top",o+N),e.get("boundingBox").setStyle("left",l[x]+N),e.get("height")!==a&&e.set("height",a);e._hasDataOverflow()&&(p="hidden")}this._drawing=!1,this._callLater?this._redraw():(k&&(k.get("boundingBox").setStyle("left",n+N),k.get("boundingBox").setStyle("top",o+N),k.set("width",r),k.set("height",a),k.get("boundingBox").setStyle("overflow",p)),this._overlay&&(this._overlay.setStyle("left",n+N),this._overlay.setStyle("top",o+N),this._overlay.setStyle("width",r+N),this._overlay.setStyle("height",a+N)))}},_getLayoutBoxDimensions:function(){var t,e,i,h,s={top:0,right:0,bottom:0,left:0},r=this.get("legend"),a=this.get(b),n=this.get(m);if(r&&r.get("includeInChartLayout")&&(h=r.get("styles").gap,"external"!==(t=r.get(d))))switch(e=r.get("direction"),i=r.get(e===o?m:b),s[t]=i+h,t){case y:r.set(v,0);break;case _:r.set(v,n-i);break;case p:r.set(S,a-i);break;case w:r.set(S,0)}return s},destructor:function(){var t=this.get("legend");t&&t.destroy(!0)}},{ATTRS:{legend:e}});z.CartesianChart=i,i=z.Base.create("pieChartLegend",z.PieChart,[],{_redraw:function(){if(this._drawing)this._callLater=!0;else{this._drawing=!0,this._callLater=!1;var t,e,i,h,s,r,a,n=this.get("graph"),o=this.get("width"),g=this.get("height"),l=this.get("legend"),d=0,c=0,f=0,u=0;if(n)if(l)if(l.get("position"),a=l.get("direction"),t=n.get("width"),e=n.get("height"),i=l.get("width"),h=l.get("height"),r=l.get("styles").gap,
"vertical"===a&&t+i+r!==o||"horizontal"===a&&e+h+r!==g){switch(l.get("position")){case w:s=Math.min(o-(i+r),g),d=i+r,l.set(m,h=g);break;case y:s=Math.min(g-(h+r),o),c=h+r,l.set(b,i=o);break;case p:f=(s=Math.min(o-(i+r),g))+r,l.set(m,h=g);break;case _:u=(s=Math.min(g-(h+r),o))+r,l.set(b,i=o)}n.set(b,s),n.set(m,s)}else switch(l.get("position")){case w:d=i+r;break;case y:c=h+r;break;case p:f=t+r;break;case _:u=e+r}else n.set(S,0),n.set(v,0),n.set(b,o),n.set(m,g);this._drawing=!1,this._callLater?this._redraw():(n&&(n.set(S,d),n.set(v,c)),l&&(l.set(S,f),l.set(v,u)))}}},{ATTRS:{legend:e}}),z.PieChart=i,z.ChartLegend=z.Base.create("chartlegend",z.Widget,[z.Renderer],{initializer:function(){this._items=[]},renderUI:function(){var t=this.get("boundingBox"),e=this.get("contentBox"),i=this.get("styles").background,e=new z.Rect({graphic:e,fill:i.fill,stroke:i.border});t.setStyle("display","block"),t.setStyle("position","absolute"),this.set("background",e)},bindUI:function(){this.get("chart").after("seriesCollectionChange",z.bind(this._updateHandler,this)),this.get("chart").after("stylesChange",z.bind(this._updateHandler,this)),this.after("stylesChange",this._updateHandler),this.after("positionChange",this._positionChangeHandler),this.after("widthChange",this._handleSizeChange),this.after("heightChange",this._handleSizeChange)},syncUI:function(){var t=this.get("width"),e=this.get("height");isFinite(t)&&isFinite(e)&&0<t&&0<e&&this._drawLegend()},_updateHandler:function(){this.get("rendered")&&this._drawLegend()},_positionChangeHandler:function(){var t=this.get("chart");this._parentNode&&t&&this.get("includeInChartLayout")?this.fire("legendRendered"):this.get("rendered")&&this._drawLegend()},_handleSizeChange:function(t){var t=t.attrName,e=this.get(d);(e!==_&&e!==y||t!==b)&&(e!==w&&e!==p||t!==m)||this._drawLegend()},_drawLegend:function(){if(this._drawing)this._callLater=!0;else{this._drawing=!0,this._callLater=!1,this.get("includeInChartLayout")&&this.get("chart")._itemRenderQueue.unshift(this);var t,e,i,h,s,r,a,n,o,g,l,d,c,f,u,y,p=this.get("chart"),_=this.get("contentBox"),w=p.get("seriesCollection"),b=this.get("styles"),m=b.padding,S=b.item,v=S.hSpacing,C=S.vSpacing,L=this.get("direction"),x="vertical"===L?b.vAlign:b.hAlign,k=b.marker,A=S.label,S=this._layout[L],B=[],I=k.width,N=k.height,M=0-v,R=0-C,D=0,O=0;if(k&&k.shape&&(a=k.shape),this._destroyLegendItems(),p instanceof z.PieChart)for(i=(t=w[0]).get("categoryAxis").getDataByKey(t.get("categoryKey")),d=(e=t.get("styles").marker).fill.colors,c=e.border.colors,f=e.border.weight,h=0,s=i.length,n=a||z.Circle,r=z.Lang.isArray(n);h<s;++h)n=r?n[h]:n,g={color:d[h]},l={colors:c[h],weight:f},i=p.getSeriesItems(t,h).category.value,u=(o=this._getLegendItem(_,this._getShapeClass(n),g,l,A,I,N,i)).width,y=o.height,D=Math.max(D,u),O=Math.max(O,y),M+=u+v,R+=y+C,B.push(o);else for(h=0,s=w.length;h<s;++h)t=w[h],e=this._getStylesBySeriesType(t,n),a||(n=(n=e.shape)||z.Circle),z.Lang.isArray(n)&&n[h],u=(o=this._getLegendItem(_,this._getShapeClass(n),e.fill,e.border,A,I,N,t.get("valueDisplayName"))).width,y=o.height,D=Math.max(D,u),O=Math.max(O,y),M+=u+v,R+=y+C,B.push(o);this._drawing=!1,this._callLater?this._drawLegend():(S._positionLegendItems.apply(this,[B,D,O,M,R,m,v,C,x]),this._updateBackground(b),this.fire("legendRendered"))}},_updateBackground:function(t){var e=t.background,i=this._contentRect,t=t.padding,h=i.left-t.left,s=i.top-t.top,r=i.right-h+t.right,i=i.bottom-s+t.bottom;this.get("background").set({fill:e.fill,stroke:e.border,width:r,height:i,x:h,y:s})},_getStylesBySeriesType:function(t){var e,i=t.get("styles");return t instanceof z.LineSeries||t instanceof z.StackedLineSeries?{border:{weight:1,color:e=(i=t.get("styles").line).color||t._getDefaultColor(t.get("graphOrder"),"line")},fill:{color:e}}:t instanceof z.AreaSeries||t instanceof z.StackedAreaSeries?{border:{weight:1,color:e=(i=t.get("styles").area).color||t._getDefaultColor(t.get("graphOrder"),"slice")},fill:{color:e}}:{fill:(i=t.get("styles").marker).fill,border:{weight:i.border.weight,color:i.border.color,shape:i.shape},shape:i.shape}},_getLegendItem:function(t,e,i,h,s,r,a,n){var o,g=z.Node.create("<div>"),l=z.Node.create("<span>");return g.setStyle(d,"absolute"),l.setStyle(d,"absolute"),l.setStyles(s),l.set("text",n),g.appendChild(l),t.append(g),s=l.get("offsetHeight"),l.setStyle("left",(o=r+(t=s-a)+2)+N),g.setStyle("height",s+N),g.setStyle("width",o+l.get("offsetWidth")+N),o=new e({fill:i,stroke:h,width:r,height:a,x:.5*t,y:.5*t,w:r,h:a,graphic:g}),l.setStyle("left",s+N),i={node:g,width:g.get("offsetWidth"),height:g.get("offsetHeight"),shape:o,textNode:l,text:n},this._items.push(i),i},_getShapeClass:function(){var t=this.get("background").get("graphic");return t._getShapeClass.apply(t,arguments)},_getDefaultStyles:function(){return{padding:{top:8,right:8,bottom:8,left:9},gap:10,hAlign:"center",vAlign:"top",marker:this._getPlotDefaults(),item:{hSpacing:10,vSpacing:5,label:{color:"#808080",fontSize:"85%",whiteSpace:"nowrap"}},background:{shape:"rect",fill:{color:"#faf9f2"},border:{color:"#dad8c9",weight:1}}}},_getPlotDefaults:function(){return{width:10,height:10}},_destroyLegendItems:function(){var t;if(this._items)for(;0<this._items.length;)(t=this._items.shift()).shape.get("graphic").destroy(),t.node.empty(),t.node.destroy(!0),t.node=null,t=null;this._items=[]},_layout:{vertical:I,horizontal:B},destructor:function(){var t=this.get("background");this._destroyLegendItems(),t&&(t.get("graphic")||t).destroy()}},{ATTRS:{includeInChartLayout:{value:!1},chart:{setter:function(t){return this.after("legendRendered",z.bind(t._itemRendered,t)),t}},direction:{value:"vertical"},position:{lazyAdd:!1,value:"right",setter:function(t){return t===y||t===_?this.set("direction",o):t!==w&&t!==p||this.set("direction","vertical"),t}},width:{getter:function(){var t=this.get("chart"),e=this._parentNode;return e?t&&this.get("includeInChartLayout")||this._width?(this._width||(this._width=0),this._width):e.get("offsetWidth"
):""},setter:function(t){return this._width=t}},height:{valueFn:"_heightGetter",getter:function(){var t=this.get("chart"),e=this._parentNode;return e?t&&this.get("includeInChartLayout")||this._height?(this._height||(this._height=0),this._height):e.get("offsetHeight"):""},setter:function(t){return this._height=t}},x:{lazyAdd:!1,value:0,setter:function(t){var e=this.get("boundingBox");return e&&e.setStyle(w,t+N),t}},y:{lazyAdd:!1,value:0,setter:function(t){var e=this.get("boundingBox");return e&&e.setStyle(y,t+N),t}},items:{getter:function(){return this._items}},background:{}}})},"@VERSION@",{requires:["charts-base"]});