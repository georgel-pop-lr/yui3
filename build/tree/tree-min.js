YUI.add("tree",function(a,e){var h=a.Lang,u=a.Base.create("tree",a.Base,[],{nodeClass:a.Tree.Node,nodeExtensions:[],_isYUITree:!0,_rootNodeConfig:{canHaveChildren:!0},initializer:function(e){(e=e||{}).nodeClass&&(this.nodeClass=e.nodeClass),e.nodeExtensions&&(this.nodeExtensions=this.nodeExtensions.concat(e.nodeExtensions)),this._published||(this._published={}),this._nodeMap={},this.onceAfter("initializedChange",function(){this._composeNodeClass(),this.clear(e.rootNode,{silent:!0}),e.nodes&&this.insertNode(this.rootNode,e.nodes,{silent:!0})})},destructor:function(){this.destroyNode(this.rootNode,{silent:!0}),this.children=null,this.rootNode=null,this._nodeClass=null,this._nodeMap=null,this._published=null},appendNode:function(e,t,n){return this.insertNode(e,t,a.merge(n,{index:e.children.length,src:"append"}))},clear:function(e,t){return this._fireTreeEvent("clear",{rootNode:this.createNode(e||this._rootNodeConfig),src:t&&t.src},{defaultFn:this._defClearFn,silent:t&&t.silent})},createNode:function(e){var t,n,i,o;if((e=e||{})._isYUITreeNode)return e.state.destroyed?(a.error("Cannot insert a node that has already been destroyed.",null,"tree"),null):(this._adoptNode(e),e);if(e.children){for(t=[],n=0,i=e.children.length;n<i;n++)t.push(this.createNode(e.children[n]));e=a.merge(e,{children:t})}return o=new this._nodeClass(this,e),this._nodeMap[o.id]=o},destroyNode:function(e,t){var n,i,o;for(t=t||{},i=0,o=e.children.length;i<o;i++)(n=e.children[i]).parent=null,this.destroyNode(n,t);return e.parent&&this.removeNode(e,t),e.children=[],e.data={},e.state={destroyed:!0},e.tree=null,e._indexMap={},delete this._nodeMap[e.id],this},emptyNode:function(e,t){for(var n=e.children,i=[],o=n.length-1;-1<o;--o)i[o]=this.removeNode(n[o],t);return i},findNode:function(e,t,n,i){var o=null;return"function"==typeof t&&(i=n,n=t,t={}),this.traverseNode(e,t,function(e){if(n.call(i,e))return o=e,u.STOP_TRAVERSAL}),o},getNodeById:function(e){return this._nodeMap[e]},insertNode:function(e,t,n){var i,o,r,s,d,l;if(n=n||{},e=e||this.rootNode,"length"in t&&h.isArray(t)){i="index"in n,o=[];for(s=0,d=t.length;s<d;s++)(r=this.insertNode(e,t[s],n))&&(o.push(r),i&&(n.index+=1));return o}return(t=this.createNode(t))&&(void 0===(l=n.index)&&(l=this._getDefaultNodeIndex(e,t,n)),this._fireTreeEvent("add",{index:l,node:t,parent:e,src:n.src||"insert"},{defaultFn:this._defAddFn,silent:n.silent})),t},prependNode:function(e,t,n){return this.insertNode(e,t,a.merge(n,{index:0,src:"prepend"}))},removeNode:function(e,t){return this._fireTreeEvent("remove",{destroy:!!(t=t||{}).destroy,node:e,parent:e.parent,src:t.src||"remove"},{defaultFn:this._defRemoveFn,silent:t.silent}),e},size:function(){return this.rootNode.size()+1},toJSON:function(){return this.rootNode.toJSON()},traverseNode:function(e,t,n,i){var o,r,s,d,l,h;if(e.state.destroyed)a.error("Cannot traverse a node that has been destroyed.",null,"tree");else{if("function"==typeof t&&(i=n,n=t,t={}),o=u.STOP_TRAVERSAL,r="undefined"==typeof(t=t||{}).depth,n.call(i,e)===o)return o;if(s=e.children,r||0<t.depth)for(d=r?t:{depth:t.depth-1},l=0,h=s.length;l<h;l++)if(this.traverseNode(s[l],d,n,i)===o)return o}},_adoptNode:function(e,t){var n,i,o,r=e.tree;if(r!==this){for(i=0,o=e.children.length;i<o;i++)(n=e.children[i]).parent=null,this._adoptNode(n,{silent:!0}),n.parent=e;e.parent&&r.removeNode(e,t),delete r._nodeMap[e.id],(e=e instanceof this._nodeClass&&r._nodeClass===this._nodeClass?e:this.createNode(e.toJSON())).tree=this,e._isIndexStale=!0,this._nodeMap[e.id]=e}},_composeNodeClass:function(){var i,e,t,o=this.nodeClass,n=this.nodeExtensions;if("string"==typeof o){if(!(o=a.Object.getValue(a,o.split("."))))return void a.error("Node class not found: "+o,null,"tree");this.nodeClass=o}if(n.length){for(i=function(){var e,t,n=i._nodeExtensions;for(o.apply(this,arguments),e=0,t=n.length;e<t;e++)n[e].apply(this,arguments)},a.extend(i,o),e=0,t=n.length;e<t;e++)a.mix(i.prototype,n[e].prototype,!0);i._nodeExtensions=n,this._nodeClass=i}else this._nodeClass=o},_fireTreeEvent:function(e,t,n){return n&&n.silent?n.defaultFn&&(t.silent=!0,n.defaultFn.call(this,t)):(n&&n.defaultFn&&!this._published[e]&&(this._published[e]=this.publish(e,{defaultFn:n.defaultFn})),this.fire(e,t)),this},_getDefaultNodeIndex:function(e){return e.children.length},_removeNodeFromParent:function(e){var t,n,i=e.parent;i&&-1<(t=i.indexOf(e))&&(t===(n=i.children).length-1?n.pop():(n.splice(t,1),i._isIndexStale=!0),e.parent=null)},_defAddFn:function(e){var t,n=e.index,i=e.node,o=e.parent;if(i.parent){if(i.parent===o){if((t=o.indexOf(i))===n)return;t<n&&--n}this.removeNode(i,{silent:e.silent,src:"add"})}(i.parent=o).children.splice(n,0,i),o.canHaveChildren=!0,o._isIndexStale=!0},_defClearFn:function(e){e=e.rootNode;this.rootNode&&this.destroyNode(this.rootNode,{silent:!0}),this._nodeMap={},this._nodeMap[e.id]=e,this.rootNode=e,this.children=e.children},_defRemoveFn:function(e){var t=e.node;e.destroy?this.destroyNode(t,{silent:!0}):e.parent?this._removeNodeFromParent(t):this.rootNode===t&&(this.rootNode=this.createNode(this._rootNodeConfig),this.children=this.rootNode.children)}},{STOP_TRAVERSAL:{}});a.Tree=a.mix(u,a.Tree)},"@VERSION@",{requires:["base-build","tree-node"]});