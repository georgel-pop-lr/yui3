YUI.add("datatable-sort",function(f,t){var e=f.Lang,r=e.isBoolean,s=e.isString,o=e.isArray,h=e.isObject,d=f.Array,u=e.sub,g={asc:1,desc:-1,1:1,"-1":-1};function a(){}a.ATTRS={sortable:{value:"auto",validator:"_validateSortable"},sortBy:{validator:"_validateSortBy",getter:"_getSortBy"},strings:{}},f.mix(a.prototype,{sort:function(t,e){return this.fire("sort",f.merge(e||{},{sortBy:t||this.get("sortBy")}))},SORTABLE_HEADER_TEMPLATE:'<div class="{className}" tabindex="0" unselectable="on"><span class="{indicatorClass}"></span></div>',toggleSort:function(t,e){for(var r,s,a=this._sortBy,o=[],i=0,n=a.length;i<n;++i)(s={})[a[i]._id]=a[i].sortDir,o.push(s);if(t){for(i=0,n=(t=d(t)).length;i<n;++i)for(s=t[i],r=o.length-1;0<=i;--i)if(o[r][s]){o[r][s]*=-1;break}}else for(i=0,n=o.length;i<n;++i)for(s in o[i])if(o[i].hasOwnProperty(s)){o[i][s]*=-1;break}return this.fire("sort",f.merge(e||{},{sortBy:o}))},_afterSortByChange:function(){this._setSortBy(),this._sortBy.length&&(this.data.comparator||(this.data.comparator=this._sortComparator),this.data.sort())},_afterSortDataChange:function(t){t.prevVal===t.newVal&&!t.newVal.hasOwnProperty("_compare")||this._initSortFn()},_afterSortRecordChange:function(t){for(var e=0,r=this._sortBy.length;e<r;++e)if(t.changed[this._sortBy[e].key]){this.data.sort();break}},_bindSortUI:function(){var t=this._eventHandles;t.sortAttrs||(t.sortAttrs=this.after(["sortableChange","sortByChange","columnsChange"],f.bind("_uiSetSortable",this))),!t.sortUITrigger&&this._theadNode&&(t.sortUITrigger=this.delegate(["click","keydown"],f.rbind("_onUITriggerSort",this),"."+this.getClassName("sortable","column")))},_defSortFn:function(t){this.set.apply(this,["sortBy",t.sortBy].concat(t.details))},_getSortBy:function(t,e){var r,s,a,o;if("state"!==(e=e.slice(7)))return t;for(r=[],s=0,a=this._sortBy.length;s<a;++s)o=this._sortBy[s],r.push({column:o._id,dir:o.sortDir});return{state:1===r.length?r[0]:r}},initializer:function(){var t=f.bind("_parseSortable",this);this._parseSortable(),this._setSortBy(),this._initSortFn(),this._initSortStrings(),this.after({"table:renderHeader":f.bind("_renderSortable",this),dataChange:f.bind("_afterSortDataChange",this),sortByChange:f.bind("_afterSortByChange",this),sortableChange:t,columnsChange:t}),this.data.after(this.data.model.NAME+":change",f.bind("_afterSortRecordChange",this)),this.publish("sort",{defaultFn:f.bind("_defSortFn",this)})},_initSortFn:function(){var h=this;this.data._compare=function(t,e){for(var r,s,a,o,i=0,n=0,l=h._sortBy.length;!i&&n<l;++n)r=(o=h._sortBy[n]).sortDir,s=o.caseSensitive,i=o.sortFn?o.sortFn(t,e,-1===r):(a=t.get(o.key)||"",o=e.get(o.key)||"",s||"string"!=typeof a||"string"!=typeof o||(a=a.toLowerCase(),o=o.toLowerCase()),o<a?r:a<o?-r:0);return i},this._sortBy.length?(this.data.comparator=this._sortComparator,this.data.sort()):delete this.data.comparator},_initSortStrings:function(){this.set("strings",f.mix(this.get("strings")||{},f.Intl.get("datatable-sort")))},_onUITriggerSort:function(t){var e,r,s,a=t.currentTarget.getAttribute("data-yui3-col-id"),o=a&&this.getColumn(a);if(("keydown"!==t.type||32===t.keyCode)&&(t.preventDefault(),o)){if(t.shiftKey){for(r=0,s=(e=this.get("sortBy")||[]).length;r<s;++r)if(a===e[r]||1===Math.abs(e[r][a])){h(e[r])||(e[r]={}),e[r][a]=-(o.sortDir||0)||1;break}s<=r&&e.push(o._id)}else(e=[{}])[0][a]=-(o.sortDir||0)||1;this.fire("sort",{originEvent:t,sortBy:e})}},_parseSortable:function(){var t,e,r,s=this.get("sortable"),a=[];if(o(s))for(t=0,e=s.length;t<e;++t)r=s[t],(r=h(r,!0)&&!o(r)?r:this.getColumn(r))&&a.push(r);else if(s&&(a=this._displayColumns.slice(),"auto"===s))for(t=a.length-1;0<=t;--t)a[t].sortable||a.splice(t,1);this._sortable=a},_renderSortable:function(){this._uiSetSortable(),this._bindSortUI()},_setSortBy:function(){var t,e,r,s,a,o,i=this._displayColumns,n=this.get("sortBy")||[],l=" "+this.getClassName("sorted");for(this._sortBy=[],t=0,e=i.length;t<e;++t)delete(o=i[t]).sortDir,o.className&&(o.className=o.className.replace(l,""));for(t=0,e=(n=d(n)).length;t<e;++t){if(r=n[t],s=1,h(r))for(r in a=r)if(a.hasOwnProperty(r)){s=g[a[r]];break}r&&(o=this.getColumn(r)||{_id:r,key:r})&&(o.sortDir=s,o.className||(o.className=""),o.className+=l,this._sortBy.push(o))}},_sortComparator:function(t){return t},_uiSetSortable:function(){var t,e,r,s,a,o,i=this._sortable||[],n=this.getClassName("sortable","column"),l=this.getClassName("sorted"),h=this.getClassName("sorted","desc"),d=this.getClassName("sort","liner"),g=this.getClassName("sort","indicator"),c={};for(this.get("boundingBox").toggleClass(this.getClassName("sortable"),i.length),t=0,e=i.length;t<e;++t)c[i[t].id]=i[t];for(this._theadNode.all("."+n).each(function(t){var e=c[t.get("id")],r=t.one("."+d);e?e.sortDir||t.removeClass(l).removeClass(h):(t.removeClass(n).removeClass(l).removeClass(h),r&&r.replace(r.get("childNodes").toFrag()),(e=t.one("."+g))&&e.remove().destroy(!0))}),t=0,e=i.length;t<e;++t)r=i[t],s=this._theadNode.one("#"+r.id),o=-1===r.sortDir,s&&(a=s.one("."+d),s.addClass(n),r.sortDir&&(s.addClass(l),s.toggleClass(h,o),s.setAttribute("aria-sort",o?"descending":"ascending")),a||((a=f.Node.create(f.Lang.sub(this.SORTABLE_HEADER_TEMPLATE,{className:d,indicatorClass:g}))).prepend(s.get("childNodes").toFrag()),s.append(a)),o=u(this.getString(1===r.sortDir?"reverseSortBy":"sortBy"),{title:r.title||"",key:r.key||"",abbr:r.abbr||"",label:r.label||"",column:r.abbr||r.label||r.key||"column "+t}),s.setAttribute("title",o),s.setAttribute("aria-labelledby",r.id))},_validateSortable:function(t){return"auto"===t||r(t)||o(t)},_validateSortBy:function(t){return null===t||s(t)||h(t,!0)||o(t)&&(s(t[0])||h(t,!0))}},!0),f.DataTable.Sortable=a,f.Base.mix(f.DataTable,[a])},"@VERSION@",{requires:["datatable-base"],lang:["en","fr","es","hu"],skinnable:!0});