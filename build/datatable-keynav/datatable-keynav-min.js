YUI.add("datatable-keynav",function(s,e){var a=s.Array.each,i=function(){};i.KEY_NAMES={8:"backspace",9:"tab",13:"enter",27:"esc",32:"space",33:"pgup",34:"pgdown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12"},i.ARIA_ACTIONS={left:"_keyMoveLeft",right:"_keyMoveRight",up:"_keyMoveUp",down:"_keyMoveDown",home:"_keyMoveRowStart",end:"_keyMoveRowEnd",pgup:"_keyMoveColTop",pgdown:"_keyMoveColBottom"},i.ATTRS={focusedCell:{setter:"_focusedCellSetter"},keyIntoHeaders:{value:!0}},s.mix(i.prototype,{keyActions:null,_keyNavSubscr:null,_keyNavTHead:null,_keyNavNestedHeaders:!1,_keyNavColPrefix:null,_keyNavColRegExp:null,initializer:function(){this.onceAfter("render",this._afterKeyNavRender),this._keyNavSubscr=[this.after("focusedCellChange",this._afterKeyNavFocusedCellChange),this.after("focusedChange",this._afterKeyNavFocusedChange)],this._keyNavColPrefix=this.getClassName("col",""),this._keyNavColRegExp=new RegExp(this._keyNavColPrefix+"(.+?)(\\s|$)"),this.keyActions=s.clone(i.ARIA_ACTIONS)},destructor:function(){a(this._keyNavSubscr,function(e){e&&e.detach&&e.detach()})},_afterKeyNavFocusedCellChange:function(e){var t=e.newVal,e=e.prevVal;e&&e.set("tabIndex",-1),t?(t.set("tabIndex",0),this.get("focused")&&(t.scrollIntoView(),t.focus())):this.set("focused",null)},_afterKeyNavFocusedChange:function(e){var t=this.get("focusedCell");e.newVal?t?(t.scrollIntoView(),t.focus()):this._keyMoveFirst():t&&t.blur()},_afterKeyNavRender:function(){var e=this.get("contentBox");this._keyNavSubscr.push(e.on("keydown",this._onKeyNavKeyDown,this),e.on("click",this._onKeyNavClick,this)),this._keyNavTHead=(this._yScrollHeader||this._tableNode).one("thead"),this._keyMoveFirst(),this._keyNavNestedHeaders=this.get("columns").length!==this.head.theadNode.all("th").size()},_onKeyNavClick:function(e){e=e.target.ancestor(this.get("keyIntoHeaders")?"td, th":"td",!0);e&&(this.focus(),this.set("focusedCell",e))},_onKeyNavKeyDown:function(t){var e,s=t.keyCode,o=i.KEY_NAMES[s]||s;a(["alt","ctrl","meta","shift"],function(e){t[e+"Key"]&&(s=e+"-"+s,o=e+"-"+o)}),"string"==typeof(e=this.keyActions[s]||this.keyActions[o])?this[e]?this[e].call(this,t):this._keyNavFireEvent(e,t):e.call(this,t)},_keyNavFireEvent:function(e,t){var s=t.target.ancestor("td, th",!0);s&&this.fire(e,{cell:s,row:s.ancestor("tr"),record:this.getRecord(s),column:this.getColumn(s.get("cellIndex"))},t)},_keyMoveFirst:function(){this.set("focusedCell",this.get("keyIntoHeaders")?this._keyNavTHead.one("th"):this._tbodyNode.one("td"),{src:"keyNav"})},_keyMoveLeft:function(e){var t=this.get("focusedCell"),s=t.get("cellIndex"),o=t.ancestor();e.preventDefault(),0!==s&&(t=o.get("cells").item(s-1),this.set("focusedCell",t,{src:"keyNav"}))},_keyMoveRight:function(e){var t=this.get("focusedCell"),s=t.ancestor("tr"),o=s.ancestor()===this._keyNavTHead;if(e.preventDefault(),e=t.next(),0!==s.get("rowIndex")&&o&&this._keyNavNestedHeaders)if(e)t=e;else{if(!(s=this._getTHParent(t))||!s.next())return;t=s.next()}else{if(!e)return;t=e}this.set("focusedCell",t,{src:"keyNav"})},_keyMoveUp:function(e){var t=this.get("focusedCell"),s=t.get("cellIndex"),o=t.ancestor("tr"),a=o.get("rowIndex"),i=o.ancestor(),n=i.get("rows"),l=i===this._keyNavTHead;if(e.preventDefault(),l||(a-=i.get("firstChild").get("rowIndex")),0===a){if(l||!this.get("keyIntoHeaders"))return;n=(i=this._keyNavTHead).get("rows"),this._keyNavNestedHeaders?(key=this._getCellColumnName(t),s=(t=i.one("."+this._keyNavColPrefix+key)).get("cellIndex"),o=t.ancestor("tr")):t=(o=i.get("firstChild")).get("cells").item(s)}else l&&this._keyNavNestedHeaders?(key=this._getCellColumnName(t),(e=this._columnMap[key]._parent)&&(t=i.one("#"+e.id))):t=(o=n.item(a-1)).get("cells").item(s);this.set("focusedCell",t)},_keyMoveDown:function(e){var t,s=this.get("focusedCell"),o=s.get("cellIndex"),a=s.ancestor("tr"),i=a.get("rowIndex")+1,n=a.ancestor(),l=n===this._keyNavTHead,r=this.body&&this.body.tbodyNode,c=n.get("rows");if(e.preventDefault(),l&&(this._keyNavNestedHeaders?(e=this._getCellColumnName(s),t=this._columnMap[e].children,i+=(s.getAttribute("rowspan")||1)-1,t?s=n.one("#"+t[0].id):(s=r.one("."+this._keyNavColPrefix+e),c=(n=r).get("rows")),o=s.get("cellIndex")):s=(a=r.one("tr")).get("cells").item(o)),(i-=c.item(0).get("rowIndex"))>=c.size()){if(!l)return;a=(n=r).one("tr")}else a=c.item(i);this.set("focusedCell",a.get("cells").item(o))},_keyMoveRowStart:function(e){var t=this.get("focusedCell").ancestor();this.set("focusedCell",t.get("firstChild"),{src:"keyNav"}),e.preventDefault()},_keyMoveRowEnd:function(e){var t=this.get("focusedCell").ancestor();this.set("focusedCell",t.get("lastChild"),{src:"keyNav"}),e.preventDefault()},_keyMoveColTop:function(e){var t,s=this.get("focusedCell"),o=s.get("cellIndex");if(e.preventDefault(),this._keyNavNestedHeaders&&this.get("keyIntoHeaders")){for(e=this._getCellColumnName(s),t=this._columnMap[e];t._parent;)t=t._parent;s=this._keyNavTHead.one("#"+t.id)}else s=(this.get("keyIntoHeaders")?this._keyNavTHead:this._tbodyNode).get("firstChild").get("cells").item(o);this.set("focusedCell",s,{src:"keyNav"})},_keyMoveColBottom:function(e){var t=this.get("focusedCell").get("cellIndex");this.set("focusedCell",this._tbodyNode.get("lastChild").get("cells").item(t),{src:"keyNav"}),e.preventDefault()},_focusedCellSetter:function(e){if(e instanceof s.Node){var t=e.get("tagName").toUpperCase();if(("TD"===t||"TH"===t)&&this.get("contentBox").contains(e))return e}else if(null===e)return e;return s.Attribute.INVALID_VALUE},_getTHParent:function(e){var t=this._getCellColumnName(e),t=this._columnMap[t]&&this._columnMap[t]._parent;return t?e.ancestor().ancestor().one("."+this._keyNavColPrefix+t.key):null},_getCellColumnName:function(e){return e.getData("yui3-col-id")||this._keyNavColRegExp.exec(e.get("className"))[1]}}),s.DataTable.KeyNav=i,s.Base.mix(s.DataTable,[i])},"@VERSION@",{requires:["datatable-base"]}
);