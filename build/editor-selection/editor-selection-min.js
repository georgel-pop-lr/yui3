YUI.add("editor-selection",function(f,e){var h="textContent",o="innerHTML",c="fontFamily";f.UA.ie&&f.UA.ie<11&&(h="nodeValue"),f.EditorSelection=function(e){var t,o,i,n,r,s=0,l=f.EditorSelection.ROOT;if(f.config.win.getSelection&&(!f.UA.ie||f.UA.ie<9||10<f.UA.ie)?t=f.config.win.getSelection():f.config.doc.selection&&(t=f.config.doc.selection.createRange()),!(this._selection=t))return!1;if(t.pasteHTML)if(this.isCollapsed=!t.compareEndPoints("StartToEnd",t),this.isCollapsed){if(this.anchorNode=this.focusNode=f.one(t.parentElement()),e&&(o=f.config.doc.elementFromPoint(e.clientX,e.clientY)),n=t.duplicate(),!o)for(i=t.parentElement().childNodes,r=0;r<i.length;r++)n.inRange(t)&&(o=o||i[r]);(this.ieNode=o)&&(3!==o.nodeType&&(o.firstChild&&(o=o.firstChild),l.compareTo(o)&&o.firstChild&&(o=o.firstChild)),this.anchorNode=this.focusNode=f.EditorSelection.resolve(o),n.moveToElementText(t.parentElement()),t.compareEndPoints("StartToStart",n)&&(s=this.getEditorOffset(l),t.move("character",-s)),this.anchorOffset=this.focusOffset=s,this.anchorTextNode=this.focusTextNode=f.one(o))}else t.htmlText&&""!==t.htmlText&&((e=f.Node.create(t.htmlText))&&e.get("id")?(l=e.get("id"),this.anchorNode=this.focusNode=f.one("#"+l)):e&&(e=e.get("childNodes"),this.anchorNode=this.focusNode=e.item(0)));else this.isCollapsed=t.isCollapsed,this.anchorNode=f.EditorSelection.resolve(t.anchorNode),this.focusNode=f.EditorSelection.resolve(t.focusNode),this.anchorOffset=t.anchorOffset,this.focusOffset=t.focusOffset,this.anchorTextNode=f.one(t.anchorNode||this.anchorNode),this.focusTextNode=f.one(t.focusNode||this.focusNode);f.Lang.isString(t.text)?this.text=t.text:t.toString?this.text=t.toString():this.text=""},f.EditorSelection.removeFontFamily=function(e){e.removeAttribute("face");var t=e.getAttribute("style").toLowerCase();""!==t&&"font-family: "!==t||e.removeAttribute("style"),t.match(f.EditorSelection.REG_FONTFAMILY)&&(t=t.replace(f.EditorSelection.REG_FONTFAMILY,""),e.setAttribute("style",t))},f.EditorSelection.filter=function(e){(new Date).getTime();var o=f.EditorSelection,t=o.ROOT,i=t.all(o.ALL),n=t.all("strong,em"),r=f.config.doc,s={},l="";(new Date).getTime();i.each(function(e){var t=f.Node.getDOMNode(e);t.style[c]&&(s["."+e._yuid]=t.style[c],e.addClass(e._yuid),o.removeFontFamily(t))}),(new Date).getTime(),t.all(".hr").addClass("yui-skip").addClass("yui-non"),f.UA.ie&&(i=f.Node.getDOMNode(t).getElementsByTagName("hr"),f.each(i,function(e){var t=r.createElement("div"),o=t.style;t.className="hr yui-non yui-skip",t.setAttribute("readonly",!0),t.setAttribute("contenteditable",!1),e.parentNode&&e.parentNode.replaceChild(t,e),o.border="1px solid #ccc",o.lineHeight="0",o.height="0",o.fontSize="0",o.marginTop="5px",o.marginBottom="5px",o.marginLeft="0px",o.marginRight="0px",o.padding="0"})),f.each(s,function(e,t){l+=t+" { font-family: "+e.replace(/"/gi,"")+"; }"}),f.StyleSheet(l,"editor"),n.each(function(e,t){e="strong"===e.get("tagName").toLowerCase()?"b":"i";o.prototype._swap(n.item(t),e)}),t.all("ol,ul").each(function(e){e.all("li").size()||e.remove()}),e&&o.filterBlocks(),(new Date).getTime()},f.EditorSelection.filterBlocks=function(){(new Date).getTime();var e,t,o,i,n,r,s=f.Node.getDOMNode(f.EditorSelection.ROOT).childNodes,l=!1,c=!0;if(s){for(e=0;e<s.length;e++)f.one(s[e]).test(f.EditorSelection.BLOCKS)?l=f.EditorSelection._wrapBlock(l):(c=!0,3===s[e].nodeType&&(i=s[e][h].match(f.EditorSelection.REG_CHAR),n=s[e][h].match(f.EditorSelection.REG_NON),null===i&&n&&(c=!1)),c&&(l=l||[]).push(s[e]));l=f.EditorSelection._wrapBlock(l)}1===(t=f.all(f.EditorSelection.DEFAULT_BLOCK_TAG)).size()?1===(o=t.item(0).all("br")).size()&&(o.item(0).test(".yui-cursor")||o.item(0).remove(),""!==(r=t.item(0).get("innerHTML"))&&" "!==r||(t.set("innerHTML",f.EditorSelection.CURSOR),(new f.EditorSelection).focusCursor(!0,!0)),o.item(0).test(".yui-cursor")&&f.UA.ie&&o.item(0).remove()):t.each(function(e){""===e.get("innerHTML")&&e.remove()}),(new Date).getTime()},f.EditorSelection.REG_FONTFAMILY=/font-family:\s*;/,f.EditorSelection.REG_CHAR=/[a-zA-Z-0-9_!@#\$%\^&*\(\)-=_+\[\]\\{}|;':",.\/<>\?]/gi,f.EditorSelection.REG_NON=/[\s|\n|\t]/gi,f.EditorSelection.REG_NOHTML=/<\S[^><]*>/g,f.EditorSelection._wrapBlock=function(e){if(e){for(var t=f.Node.create("<"+f.EditorSelection.DEFAULT_BLOCK_TAG+"></"+f.EditorSelection.DEFAULT_BLOCK_TAG+">"),o=f.one(e[0]),i=1;i<e.length;i++)t.append(e[i]);o.replace(t),t.prepend(o)}return!1},f.EditorSelection.unfilter=function(){var e=f.EditorSelection.ROOT,t=e.all("[class]"),o="",i=e;return t.each(function(e){e.hasClass(e._yuid)&&(e.setStyle(c,e.getStyle(c)),e.removeClass(e._yuid),""===e.getAttribute("class")&&e.removeAttribute("class"))}),e.all(".yui-non").each(function(e){e.hasClass("yui-skip")||""!==e.get("innerHTML")?e.removeClass("yui-non").removeClass("yui-skip"):e.remove()}),e.all("[id]").each(function(e){0===e.get("id").indexOf("yui_3_")&&(e.removeAttribute("id"),e.removeAttribute("_yuid"))}),i&&(o=i.get("innerHTML")),e.all(".hr").addClass("yui-skip").addClass("yui-non"),o},f.EditorSelection.resolve=function(e){if(!e)return f.EditorSelection.ROOT;if(e&&3===e.nodeType)try{e=e.parentNode}catch(t){e=f.EditorSelection.ROOT}return f.one(e)},f.EditorSelection.getText=function(e){return e.get("innerHTML").replace(f.EditorSelection.REG_NOHTML,"").replace("<span><br></span>","").replace("<br>","")},f.EditorSelection.DEFAULT_BLOCK_TAG="p",f.EditorSelection.ALL="[style],font[face]",f.EditorSelection.BLOCKS="p,div,ul,ol,table,style",f.EditorSelection.TMP="yui-tmp",f.EditorSelection.DEFAULT_TAG="span",f.EditorSelection.CURID="yui-cursor",f.EditorSelection.CUR_WRAPID="yui-cursor-wrapper",f.EditorSelection.CURSOR='<span><br class="yui-cursor"></span>',f.EditorSelection.ROOT=f.one("body"),f.EditorSelection.hasCursor=function(){return f.all("#"+f.EditorSelection.CUR_WRAPID).size()},f.EditorSelection.cleanCursor=function(){var e=f.all("br.yui-cursor");e.size()&&e.each(function(e){var t=e.get("parentNode.parentNode.childNodes");
!t.size()&&""===f.EditorSelection.getText(t.item(0))||e.remove()})},f.EditorSelection.prototype={text:null,isCollapsed:null,anchorNode:null,anchorOffset:null,anchorTextNode:null,focusNode:null,focusOffset:null,focusTextNode:null,_selection:null,_wrap:function(e,t){t=f.Node.create("<"+t+"></"+t+">");return t.set(o,e.get(o)),e.set(o,""),e.append(t),f.Node.getDOMNode(t)},_swap:function(e,t){t=f.Node.create("<"+t+"></"+t+">");return t.set(o,e.get(o)),e.replace(t,e),f.Node.getDOMNode(t)},getSelected:function(){var o,i=f.EditorSelection,n=i.ROOT,r=[];return i.filter(),f.config.doc.execCommand("fontname",null,i.TMP),(o=n.all(i.ALL)).each(function(e,t){e.getStyle(c)===i.TMP&&(e.setStyle(c,""),i.removeFontFamily(e),e.compareTo(n)||r.push(f.Node.getDOMNode(o.item(t))))}),f.all(r)},insertContent:function(e){return this.insertAtCursor(e,this.anchorTextNode,this.anchorOffset,!0)},insertAtCursor:function(e,t,o,i){var n,r,s,l,c=f.Node.create("<"+f.EditorSelection.DEFAULT_TAG+' class="yui-non"></'+f.EditorSelection.DEFAULT_TAG+">"),a=this.createRange(),d=f.EditorSelection.ROOT;if(d.compareTo(t)&&(l=f.Node.create("<span></span>"),t.append(l),t=l),a.pasteHTML){if(0===o&&t&&!t.previous()&&3===t.get("nodeType"))return t.insert(e,"before"),a.moveToElementText&&a.moveToElementText(f.Node.getDOMNode(t.previous())),a.collapse(!1),a.select(),t.previous();s=f.Node.create(e);try{a.pasteHTML('<span id="rte-insert"></span>')}catch(u){}if(n=d.one("#rte-insert"))return n.set("id",""),n.replace(s),a.moveToElementText&&a.moveToElementText(f.Node.getDOMNode(s)),a.collapse(!1),a.select(),s;f.on("available",function(){n.set("id",""),n.replace(s),a.moveToElementText&&a.moveToElementText(f.Node.getDOMNode(s)),a.collapse(!1),a.select()},"#rte-insert")}else 0<o?(n=t.get(h),r=f.one(f.config.doc.createTextNode(n.substr(0,o))),o=f.one(f.config.doc.createTextNode(n.substr(o))),t.replace(r,t),11===(s=f.Node.create(e)).get("nodeType")&&((l=f.Node.create("<span></span>")).append(s),s=l),r.insert(s,"after"),o&&(s.insert(c,"after"),c.insert(o,"after"),this.selectNode(c,i))):(3===t.get("nodeType")&&(t=t.get("parentNode")||d),s=f.Node.create(e),""===(e=t.get("innerHTML").replace(/\n/gi,""))||"<br>"===e?t.append(s):s.get("parentNode")?t.insert(s,"before"):d.prepend(s),t.get("firstChild").test("br")&&t.get("firstChild").remove());return s},wrapContent:function(o){var i,n,e,t,r;return o=o||f.EditorSelection.DEFAULT_TAG,this.isCollapsed?f.all([]):(i=this.getSelected(),n=[],i.each(function(e,t){"font"===e.get("tagName").toLowerCase()?n.push(this._swap(i.item(t),o)):n.push(this._wrap(i.item(t),o))},this),e=this.createRange(),r=n[0],t=n[n.length-1],this._selection.removeAllRanges?(e.setStart(n[0],0),e.setEnd(t,t.childNodes.length),this._selection.removeAllRanges(),this._selection.addRange(e)):(e.moveToElementText&&(e.moveToElementText(f.Node.getDOMNode(r)),(r=this.createRange()).moveToElementText(f.Node.getDOMNode(t)),e.setEndPoint("EndToEnd",r)),e.select()),n=f.all(n))},replace:function(e,t){var o,i,n=this.createRange(),e=n.getBookmark?(i=n.getBookmark(),o=this.anchorNode.get("innerHTML").replace(e,t),this.anchorNode.set("innerHTML",o),n.moveToBookmark(i),f.one(n.parentElement())):(i=(o=(n=this.anchorTextNode).get(h)).indexOf(e),o=o.replace(e,""),n.set(h,o),this.insertAtCursor(t,n,i,!0));return e},remove:function(){return this._selection&&this._selection.removeAllRanges&&this._selection.removeAllRanges(),this},createRange:function(){return(f.config.doc.selection||f.config.doc).createRange()},selectNode:function(e,t,o){if(e){o=o||0,e=f.Node.getDOMNode(e);var i=this.createRange();if(i.selectNode){try{i.selectNode(e)}catch(n){}if(this._selection.removeAllRanges(),this._selection.addRange(i),t)try{this._selection.collapse(e,o)}catch(n){this._selection.collapse(e,0)}}else{3===e.nodeType&&(e=e.parentNode);try{i.moveToElementText(e)}catch(r){}t&&i.collapse(!o),i.select()}return this}},setCursor:function(){return this.removeCursor(!1),this.insertContent(f.EditorSelection.CURSOR)},getCursor:function(){return f.EditorSelection.ROOT.all("."+f.EditorSelection.CURID).get("parentNode")},removeCursor:function(e){var t=this.getCursor();return t&&t.remove&&(e?t.set("innerHTML",'<br class="yui-cursor">'):t.remove()),t},focusCursor:function(t,o){!1!==t&&(t=!0),!1!==o&&(o=!0);var e=this.removeCursor(!0);e&&e.each(function(e){this.selectNode(e,t,o)},this)},toString:function(){return"EditorSelection Object"},getEditorOffset:function(e){var t,o,e=(e||f.EditorSelection.ROOT).getDOMNode(),i=0,n=f.config.doc,r=f.config.win;return"undefined"!=typeof r.getSelection?((o=(t=r.getSelection().getRangeAt(0)).cloneRange()).selectNodeContents(e),o.setEnd(t.endContainer,t.endOffset),i=o.toString().length):(r=n.selection)&&"Control"!==r.type&&(t=r.createRange(),(o=n.body.createTextRange()).moveToElementText(e),o.setEndPoint("EndToEnd",t),i=o.text.length),i}},f.Selection=f.EditorSelection},"@VERSION@",{requires:["node"]});